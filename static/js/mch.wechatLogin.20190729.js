window['MCH.wechatLogin.time'] && window['MCH.wechatLogin.time'].push(new Date());
function $addToken(url,type,skey){var token=$getToken(skey);if(url==""||(url.indexOf("://")<0?location.href:url).indexOf("http")!=0){return url;}
if(url.indexOf("#")!=-1){var f1=url.match(/\?.+\#/);if(f1){var t=f1[0].split("#"),newPara=[t[0],"&g_tk=",token,"&g_ty=",type,"#",t[1]].join("");return url.replace(f1[0],newPara);}else{var t=url.split("#");return[t[0],"?g_tk=",token,"&g_ty=",type,"#",t[1]].join("");}}
return token==""?(url+(url.indexOf("?")!=-1?"&":"?")+"g_ty="+type):(url+(url.indexOf("?")!=-1?"&":"?")+"g_tk="+token+"&g_ty="+type);};var $ajax=(function(window,undefined){var oXHRCallbacks,xhrCounter=0;var fXHRAbortOnUnload=window.ActiveXObject?function(){for(var key in oXHRCallbacks){oXHRCallbacks[key](0,1);}}:false;return function(opt){var o={url:'',method:'GET',data:null,type:"text",async:true,cache:false,timeout:0,autoToken:true,username:'',password:'',beforeSend:$empty(),onSuccess:$empty(),onError:$empty(),onComplete:$empty()};for(var key in opt){o[key]=opt[key]}
var callback,timeoutTimer,xhrCallbackHandle,ajaxLocation,ajaxLocParts;try{ajaxLocation=location.href;}
catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href;}
ajaxLocParts=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/.exec(ajaxLocation.toLowerCase())||[];o.isLocal=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(ajaxLocParts[1]);o.method=(typeof(o.method)!="string"||o.method.toUpperCase()!="POST")?"GET":"POST";o.data=(typeof o.data=="string")?o.data:$makeUrl(o.data);if(o.method=='GET'&&o.data){o.url+=(o.url.indexOf("?")<0?"?":"&")+o.data;}
if(o.autoToken){o.url=$addToken(o.url,"ajax");}
o.xhr=$xhrMaker();if(o.xhr===null){return false;}
try{if(o.username){o.xhr.open(o.method,o.url,o.async,o.username,o.password);}
else{o.xhr.open(o.method,o.url,o.async);}}
catch(e){o.onError(-2,e);return false;}
if(o.method=='POST'){o.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
if(!o.cache){o.xhr.setRequestHeader('If-Modified-Since','Thu, 1 Jan 1970 00:00:00 GMT');o.xhr.setRequestHeader('Cache-Control','no-cache');}
o.beforeSend(o.xhr);if(o.async&&o.timeout>0){if(o.xhr.timeout===undefined){timeoutTimer=setTimeout(function(){if(o.xhr&&callback){callback(0,1);}
o.onError(0,null,'timeout');},o.timeout);}
else{o.xhr.timeout=o.timeout;o.xhr.ontimeout=function(){if(o.xhr&&callback){callback(0,1);}
o.onError(0,null,'timeout');};}}
o.xhr.send(o.method=='POST'?o.data:null);callback=function(e,isAbort){if(timeoutTimer){clearTimeout(timeoutTimer);timeoutTimer=undefined;}
if(callback&&(isAbort||o.xhr.readyState===4)){callback=undefined;if(xhrCallbackHandle){o.xhr.onreadystatechange=$empty();if(fXHRAbortOnUnload){try{delete oXHRCallbacks[xhrCallbackHandle];}
catch(e){}}}
if(isAbort){if(o.xhr.readyState!==4){o.xhr.abort();}}
else{var status,statusText,responses;responses={headers:o.xhr.getAllResponseHeaders()};status=o.xhr.status;try{statusText=o.xhr.statusText;}
catch(e){statusText="";}
try{responses.text=o.xhr.responseText;}
catch(e){responses.text="";}
if(!status&&o.isLocal){status=responses.text?200:404;}
else if(status===1223){status=204;}
if(status>=200&&status<300){responses.text=responses.text.replace(/<!--\[if !IE\]>[\w\|]+<!\[endif\]-->/g,'');switch(o.type){case'text':o.onSuccess(responses.text);break;case"json":var json;try{json=(new Function("return ("+responses.text+")"))();}
catch(e){o.onError(status,e,responses.text);}
if(json){o.onSuccess(json);}
break;case"xml":o.onSuccess(o.xhr.responseXML);break;}}
else{if(status===0&&o.timeout>0){o.onError(status,null,'timeout');}
else{o.onError(status,null,statusText);}}
o.onComplete(status,statusText,responses);}
delete o.xhr;}};if(!o.async){callback();}
else if(o.xhr.readyState===4){setTimeout(callback,0);}
else{xhrCallbackHandle=++xhrCounter;if(fXHRAbortOnUnload){if(!oXHRCallbacks){oXHRCallbacks={};if(window.attachEvent){window.attachEvent("onunload",fXHRAbortOnUnload);}
else{window["onunload"]=fXHRAbortOnUnload;}}
oXHRCallbacks[xhrCallbackHandle]=callback;}
o.xhr.onreadystatechange=callback;}};})(window,undefined);function $empty(){return function(){return true;}};function $getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;};function $getQuery(name,url){var u=arguments[1]||window.location.search,reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=u.substr(u.indexOf("\?")+1).match(reg);return r!=null?r[2]:"";};function $getToken(skey){var skey=skey?skey:$getCookie("skey");return skey?$time33(skey):"";};function $makeUrl(data){var arr=[];for(var k in data){arr.push(k+"="+data[k]);};return arr.join("&");};function $namespace(name){for(var arr=name.split(','),r=0,len=arr.length;r<len;r++){for(var i=0,k,name=arr[r].split('.'),parent={};k=name[i];i++){i===0?eval('(typeof '+k+')==="undefined"?('+k+'={}):"";parent='+k):(parent=parent[k]=parent[k]||{});}}};function $time33(str){for(var i=0,len=str.length,hash=5381;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();};return hash&0x7fffffff;};function $xhrMaker(){var xhr;try{xhr=new XMLHttpRequest();}catch(e){try{xhr=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP");}catch(e){xhr=null;}}};return xhr;};$namespace("MCH.wechatLogin");MCH.wechatLogin={finger:'',type:0,employeeId:0,qrcodeSessionId:'',setIntervalId:0,fingetFailCount:0,getQrcodeStateFailCount:0,MAX_GET_QRCODE_STATE_FAIL_COUNT:3,GET_QRCODE_STATE_TIME:3,isOnGetQrcode:false,JS_QRCODE_EMPTY_ACCOUNT:-1,JS_QRCODE_INVALID:-2,JS_QRCODE_HAS_NO_AUTH:-3,JS_QRCODE_SCANED:100,JS_QRCODE_LOGIN_SUCCESS:101,JS_QRCODE_REFUSE_LOGIN:102,JS_QRCODE_CONFIRM_SUCC:104,JS_QRCODE_LIMIT_MERCHANT:105,MAX_FINGER_FAIL_COUNT:10,RET_CODE_STAFF_CREATED_IN_WECHAT_LOGIN:2,RET_CODE_BINDED:0,RET_CODE_UNBINDED:1,RET_CODE_INPUT_INVALID:-100};var log=function(){};var debug=location.search.split('debug=')[1];if(debug!=undefined&&(debug=='true'||debug==true)){if(typeof console.log!='undefined'){log=console.log;$('#IDWechatLogin').removeClass('hide');$('#IDAccountLogin').addClass('hide');}}
MCH.wechatLogin.init=function(){wechatLoginThat=MCH.wechatLogin;wechatLoginThat.bindEvent();try{if(typeof qrcodeType!='undefined'){wechatLoginThat.type=qrcodeType;}
if(typeof qrcodeEmployeeId!='undefined'){wechatLoginThat.employeeId=qrcodeEmployeeId;}}catch(e){log(e);}};$.extend({redirectPost:function(location,args){var form='';$.each(args,function(key,value){form+='<input type="hidden" name="'+key+'" value="'+value+'">';});$('<form action="'+location+'" method="POST">'+form+'</form>').appendTo('body').submit();}});MCH.wechatLogin.loginSuccess=function(jump){var token_name=$("#token").attr("name");var loginType=$("input[name='login_type']").val();var hash=$("#token").val();var postData={login_type:loginType,jump:jump};var returnUrls=location.search.split('return_url=');if(returnUrls.length>=2){postData['return_url']=returnUrls[1];}
postData[token_name]=hash;$.redirectPost('https://pay.weixin.qq.com/index.php/core/home/loginJumpForQrcode',postData);};MCH.wechatLogin.bindEvent=function(){var errorType=$getQuery('error_type');if(errorType==""){$('#IDSwitchAccountLogin').removeClass('selected');$('#IDSwitchWechatLogin').addClass('selected');if(wechatLoginThat.qrcodeSessionId.length<=0){wechatLoginThat.getQrcode();}}
else{$('#IDSwitchWechatLogin').removeClass('selected');$('#IDSwitchAccountLogin').addClass('selected');$('#IDWechatLogin').addClass('hide');$('#IDAccountLogin').removeClass('hide');}
$("input[name=username]").on("blur",function(){MCH.home.userNameBlur();ret=wechatLoginThat.getBindState();switch(ret.code){case wechatLoginThat.RET_CODE_STAFF_CREATED_IN_WECHAT_LOGIN:$('#IDWechatLogin').addClass('hide');$("#IDAccountLogin").addClass("hide");$("#IDWechatLoginTip").removeClass("hide");$("#IDTipTit").text("当前账号需使用扫码登录");$("#IDTipTxt").text("绑定微信后可使用扫码登录，");$("#IDTipLink").text("点击绑定");$("#IDTipLink").attr('href','https://pay.weixin.qq.com/index.php/public/bind_wechat');break;case wechatLoginThat.RET_CODE_BINDED:$('#IDWechatLogin').addClass('hide');$("#IDAccountLogin").addClass("hide");$("#IDWechatLoginTip").removeClass("hide");$("#IDTipTit").text("登录账号已绑定微信号，请扫码登录");$("#IDTipTxt").text("如非本人微信号绑定，或登录账号多人使用，请使用");$("#IDTipLink").text("员工账号管理");$("#IDTipLink").attr('href','http://kf.qq.com/faq/140225MveaUz150107EvMfyq.html');break;case wechatLoginThat.RET_CODE_UNBINDED:$(".login-form").removeClass("login-account-on");$(".login-form").addClass("login-password-on");MCH.home.tenpayEdit.show();break;default:break;}});$('#IDSwitchWechatLogin').on('click',function(){$(this).siblings().removeClass('selected');$(this).addClass('selected');$("#IDWechatLoginTip").addClass('hide');$('#IDAccountLogin').addClass('hide');$('#IDWechatLogin').removeClass('hide');if(wechatLoginThat.qrcodeSessionId.length<=0){wechatLoginThat.getQrcode();}});$('#IDSwitchAccountLogin').on('click',function(){$(this).siblings().removeClass('selected');$(this).addClass('selected');$('#IDWechatLogin').addClass('hide');$("#IDWechatLoginTip").addClass('hide');$('#IDAccountLogin').removeClass('hide');$("input[name=username]").val('');$("input[name=username]").focus();});$('#IDQrcodeInvalid').on('click',function(){wechatLoginThat.refreshQrcode();});$('#IDRefuseLoginReturn').on('click',function(){$('#IDRefuseLogin').addClass('hide');$('#IDQrcode').removeClass('hide');wechatLoginThat.getQrcode();});};MCH.wechatLogin.getBindState=function(){var ret={code:wechatLoginThat.RET_CODE_INPUT_INVALID,msg:""};var username=$(".login-form").find("input[name=username]").val();if(username.length<=3){return ret;}
var token_name=$("#token").attr("name");var hash=$("#token").val();var postData="username="+username+"&"+token_name+"="+hash;$ajax({url:"/index.php/public/bind_wechat/getAccountBindState",data:postData,method:"post",type:"json",async:false,onSuccess:function(data){MCH.header.handleAjax(data);ret.code=data.errorcode;},onError:function(msg){}});return ret;};MCH.wechatLogin.getFinger=function(obj){if(wechatLoginThat.finger!==""&&wechatLoginThat.finger!==undefined&&wechatLoginThat.finger.length>10)
{obj();}
new Fingerprint2().get(function(result,components){log(result,wechatLoginThat.finger);wechatLoginThat.finger=result;if(wechatLoginThat.finger.length<0){wechatLoginThat.fingetFailCount++;}
if(wechatLoginThat.fingetFailCount>wechatLoginThat.MAX_FINGER_FAIL_COUNT){wechatLoginThat.finger='finger_out_max_fail';}
obj();});};MCH.wechatLogin.refreshQrcode=function(){if($('#IDQrcodeInvalid').hasClass('hide')){return false;}
if(wechatLoginThat.isOnGetQrcode){return false;}
wechatLoginThat.isOnGetQrcode=true;wechatLoginThat.getQrcode();};MCH.wechatLogin.getQrcode=function(){log(wechatLoginThat.finger);if(wechatLoginThat.finger.length<=0){wechatLoginThat.getFinger(wechatLoginThat.getQrcode);return false;}
$('#IDQrcode').removeClass('hide');$('.js-weapp-qrcode').addClass('hide');var token_name=$("#token").attr("name");var hash=$("#token").val();var postData={type:wechatLoginThat.type,employeeId:wechatLoginThat.employeeId,finger:wechatLoginThat.finger};postData[token_name]=hash;$ajax({url:'/index.php/core/home/getQrcode?nowTime='+new Date().getTime(),method:'post',data:postData,type:'json',async:true,onSuccess:function(resp){log(resp);wechatLoginThat.isOnGetQrcode=false;if(resp.errorcode==0){wechatLoginThat.qrcodeSessionId=resp.data.qrcodeSessionId;if(resp.data.genQrcodeType==0){$('#IDQrcodeImg').html('');var url="https://pay.weixin.qq.com/core/home/s?s="+wechatLoginThat.qrcodeSessionId;new QRCode(document.getElementById("IDQrcodeImg"),{text:url,width:180,height:180,correctLevel:QRCode.CorrectLevel.M});}else{$('#IDQrcodeImg').html('<img src="'+resp.data.qrcodeUrl+'"/>');}
$('#IDQrcodeInvalid').addClass('hide');wechatLoginThat.getQrcodeStateFailCount=0;wechatLoginThat.setIntervalId=setInterval(wechatLoginThat.getQrcodeState,wechatLoginThat.GET_QRCODE_STATE_TIME*1000);return true;}
wechatLoginThat.showErrorMsg(resp.msg);},onError:function(msg){wechatLoginThat.showErrorMsg('网络错误 '+msg+'，请刷新页面重试');}});};MCH.wechatLogin.getQrcodeStateWithLogin=function(){var token_name=$("#token").attr("name");var hash=$("#token").val();var postData={type:wechatLoginThat.type,employeeId:wechatLoginThat.employeeId,finger:wechatLoginThat.finger,sign:wechatLoginThat.qrcodeSessionId};postData[token_name]=hash;$ajax({url:'/index.php/core/home/getQrcodeState?nowTime='+new Date().getTime(),method:'post',data:postData,type:'json',async:true,onSuccess:function(resp){log(resp);wechatLoginThat.closeErrorMsg();switch(resp.errorcode){case 0:return true;case wechatLoginThat.JS_QRCODE_LOGIN_SUCCESS:wechatLoginThat.loginSuccess(resp.data.jump);return true;case wechatLoginThat.JS_QRCODE_EMPTY_ACCOUNT:$('#IDQrcode').addClass('hide');$('#IDHasNotBind').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_HAS_NO_AUTH:var role_name=resp.data.role_name;var authority_name=resp.data.authority_name;var check_auth_result=resp.data.check_auth_result;var url="https://pay.weixin.qq.com/index.php/core/home/show_err_page?role_name="+role_name+"&authority_name="+authority_name+"&check_auth_result="+check_auth_result;$('#IDHasNotAuth').siblings('div').addClass('hide');$('#IDHasNotAuth').find('a').attr('href',url);$('#IDHasNotAuth').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_LIMIT_MERCHANT:if(resp.data.weappQrcodeSrc!==undefined){$('#IDQrcodeScaned').addClass('hide');$('#IDQrcode').addClass('hide');$('#IDQrcode').after('<img class="js-weapp-qrcode qrcode-img" src="'+resp.data.weappQrcodeSrc+'">');wechatLoginThat.showErrorMsg(resp.msg);}else{wechatLoginThat.showErrorMsg("该商户号类型无法登录商户平台");}
return true;case wechatLoginThat.JS_QRCODE_INVALID:$('#IDQrcodeScaned').addClass('hide');$('#IDQrcodeInvalid').removeClass('hide');$('#IDQrcode').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_SCANED:$('#IDQrcode').addClass('hide');$('#IDQrcodeScaned').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_REFUSE_LOGIN:$('#IDQrcode').addClass('hide');$('#IDQrcodeScaned').addClass('hide');$('#IDRefuseLogin').removeClass('hide');return true;default:wechatLoginThat.getQrcodeStateFailCount++;wechatLoginThat.showErrorMsg(resp.msg);return true;}},onError:function(msg){wechatLoginThat.getQrcodeStateFailCount++;wechatLoginThat.showErrorMsg('网络错误 '+msg+' 请刷新页面重试');}});};MCH.wechatLogin.getQrcodeState=function(){if(wechatLoginThat.getQrcodeStateFailCount>wechatLoginThat.MAX_GET_QRCODE_STATE_FAIL_COUNT){clearInterval(wechatLoginThat.setIntervalId);$('#IDQrcodeScaned').addClass('hide');$('#IDQrcodeInvalid').removeClass('hide');$('#IDQrcode').removeClass('hide');return;}
if(wechatLoginThat.finger.length<=0){wechatLoginThat.getFinger(wechatLoginThat.GetQrcodeState);return false;}
var token_name=$("#token").attr("name");var hash=$("#token").val();var postData={type:wechatLoginThat.type,employeeId:wechatLoginThat.employeeId,finger:wechatLoginThat.finger,qrcode_session_id:wechatLoginThat.qrcodeSessionId};postData[token_name]=hash;$ajax({url:'https://pay.weixin.qq.com/mch/wechatlogin/login/getQrcodeState?nowTime='+new Date().getTime(),method:'post',data:JSON.stringify(postData),type:'json',async:true,onSuccess:function(resp){log(resp);wechatLoginThat.closeErrorMsg();switch(resp.errcode){case 0:return true;case wechatLoginThat.JS_QRCODE_CONFIRM_SUCC:clearInterval(wechatLoginThat.setIntervalId);wechatLoginThat.getQrcodeStateWithLogin();return true;case wechatLoginThat.JS_QRCODE_LOGIN_SUCCESS:clearInterval(wechatLoginThat.setIntervalId);wechatLoginThat.loginSuccess(resp.data.jump);return true;case wechatLoginThat.JS_QRCODE_EMPTY_ACCOUNT:clearInterval(wechatLoginThat.setIntervalId);$('#IDQrcode').addClass('hide');$('#IDHasNotBind').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_HAS_NO_AUTH:clearInterval(wechatLoginThat.setIntervalId);var role_name=resp.data.role_name;var authority_name=resp.data.authority_name;var check_auth_result=resp.data.check_auth_result;var url="https://pay.weixin.qq.com/index.php/core/home/show_err_page?role_name="+role_name+"&authority_name="+authority_name+"&check_auth_result="+check_auth_result;$('#IDHasNotAuth').siblings('div').addClass('hide');$('#IDHasNotAuth').find('a').attr('href',url);$('#IDHasNotAuth').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_INVALID:clearInterval(wechatLoginThat.setIntervalId);$('#IDQrcodeScaned').addClass('hide');$('#IDQrcodeInvalid').removeClass('hide');$('#IDQrcode').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_SCANED:$('#IDQrcode').addClass('hide');$('#IDQrcodeScaned').removeClass('hide');return true;case wechatLoginThat.JS_QRCODE_REFUSE_LOGIN:clearInterval(wechatLoginThat.setIntervalId);$('#IDQrcode').addClass('hide');$('#IDQrcodeScaned').addClass('hide');$('#IDRefuseLogin').removeClass('hide');return true;default:wechatLoginThat.getQrcodeStateFailCount++;wechatLoginThat.showErrorMsg(resp.errmsg);return true;}},onError:function(msg){wechatLoginThat.getQrcodeStateFailCount++;wechatLoginThat.showErrorMsg('网络错误 '+msg+' 请刷新页面重试');}});};MCH.wechatLogin.showErrorMsg=function(msg){$('#IDQrcodeError').removeClass('hide').text(msg);};MCH.wechatLogin.closeErrorMsg=function(){$('#IDQrcodeError').addClass('hide').text('');};MCH.wechatLogin.init();
window['MCH.wechatLogin']='22646:20190729:20190806154339';
window['MCH.wechatLogin.time'] && window['MCH.wechatLogin.time'].push(new Date());/*  |xGv00|576339d1c921951e78e7dc4cfad76a35 */